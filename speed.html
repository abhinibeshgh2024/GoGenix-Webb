<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Webb | Pro Network Analyzer</title>
    <style>
        :root {
            --primary: #38bdf8;
            --accent: #818cf8;
            --bg: #0b0f1a;
            --card: rgba(255, 255, 255, 0.05);
            --border: rgba(255, 255, 255, 0.1);
        }

        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Inter', sans-serif; }

        body {
            min-height: 100vh;
            background: radial-gradient(circle at top right, #1e293b, #0b0f1a);
            color: #fff;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px;
        }

        header { text-align: center; margin-bottom: 20px; width: 100%; }
        .logo-img { width: 100px; filter: drop-shadow(0 0 10px var(--primary)); }

        .main-container {
            width: 100%;
            max-width: 600px;
            background: var(--card);
            backdrop-filter: blur(10px);
            border: 1px solid var(--border);
            border-radius: 30px;
            padding: 30px;
            box-shadow: 0 25px 50px -12px rgba(0,0,0,0.5);
        }

        /* NETWORK INFO BAR */
        .network-info {
            display: flex;
            justify-content: space-between;
            background: rgba(0,0,0,0.3);
            padding: 15px;
            border-radius: 15px;
            margin-bottom: 25px;
            font-size: 13px;
        }
        .info-item span { color: #64748b; display: block; margin-bottom: 3px; }
        .info-item b { color: var(--primary); }

        /* METER */
        .meter-section {
            position: relative;
            height: 250px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            margin-bottom: 30px;
        }

        .scanner {
            position: absolute;
            width: 220px;
            height: 220px;
            border-radius: 50%;
            border: 2px solid var(--border);
        }

        .testing .scanner {
            border-top: 4px solid var(--primary);
            animation: spin 0.8s linear infinite;
        }

        #speed-val { font-size: 80px; font-weight: 800; line-height: 1; margin-bottom: 5px; }
        .test-label { color: var(--primary); font-weight: 600; letter-spacing: 2px; text-transform: uppercase; font-size: 12px; }

        /* RESULTS GRID */
        .results-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
            margin-bottom: 30px;
        }

        .res-card {
            background: rgba(255,255,255,0.02);
            border: 1px solid var(--border);
            padding: 15px;
            border-radius: 20px;
            text-align: center;
        }
        .res-card small { font-size: 10px; color: #64748b; text-transform: uppercase; }
        .res-card div { font-size: 18px; font-weight: 700; margin-top: 5px; }

        /* BUTTON */
        #actionBtn {
            width: 100%;
            padding: 18px;
            border-radius: 15px;
            border: none;
            background: var(--primary);
            color: #000;
            font-size: 16px;
            font-weight: 800;
            cursor: pointer;
            transition: 0.3s;
        }
        #actionBtn:hover { transform: translateY(-2px); box-shadow: 0 10px 20px rgba(56,189,248,0.3); }
        #actionBtn:disabled { background: #334155; color: #64748b; cursor: wait; }

        @keyframes spin { 100% { transform: rotate(360deg); } }
    </style>
</head>
<body>

<header>
    <img src="WEBB-removebg-preview.png" class="logo-img" alt="Webb Logo">
</header>

<div class="main-container">
    <div class="network-info">
        <div class="info-item"><span>IP ADDRESS</span><b id="user-ip">Detecting...</b></div>
        <div class="info-item"><span>PROVIDER</span><b id="user-isp">-</b></div>
        <div class="info-item"><span>LOCATION</span><b id="user-loc">-</b></div>
    </div>

    <div class="meter-section" id="meter">
        <div class="scanner"></div>
        <div id="speed-val">0</div>
        <div class="test-label" id="phase-label">Ready</div>
    </div>

    <div class="results-grid">
        <div class="res-card">
            <small>Ping</small>
            <div id="res-ping">--</div>
        </div>
        <div class="res-card">
            <small>Download</small>
            <div id="res-down">--</div>
        </div>
        <div class="res-card">
            <small>Upload</small>
            <div id="res-up">--</div>
        </div>
    </div>

    <button id="actionBtn" onclick="runFullTest()">START TEST</button>
</div>

<script>
    // 1. Initialize Network Info
    async function getNetworkDetails() {
        try {
            const response = await fetch('https://ipapi.co/json/');
            const data = await response.json();
            document.getElementById('user-ip').innerText = data.ip;
            document.getElementById('user-isp').innerText = data.org.split(' ')[0];
            document.getElementById('user-loc').innerText = data.city + ", " + data.country_code;
        } catch (e) {
            document.getElementById('user-ip').innerText = "Unknown";
        }
    }
    getNetworkDetails();

    const speedVal = document.getElementById('speed-val');
    const phaseLabel = document.getElementById('phase-label');
    const meter = document.getElementById('meter');
    const actionBtn = document.getElementById('actionBtn');

    let isTesting = false;

    // Numbers shuffle effect
    function shuffle() {
        if(!isTesting) return;
        speedVal.innerText = (Math.random() * 50 + 10).toFixed(1);
        setTimeout(shuffle, 70);
    }

    async function runFullTest() {
        isTesting = true;
        actionBtn.disabled = true;
        meter.classList.add('testing');
        
        // --- PHASE 1: PING ---
        phaseLabel.innerText = "Checking Latency...";
        const pings = [];
        for(let i=0; i<4; i++) {
            const s = performance.now();
            await fetch('https://1.1.1.1/favicon.ico?t=' + Math.random(), {mode: 'no-cors'});
            pings.push(performance.now() - s);
        }
        const pingResult = Math.min(...pings).toFixed(0);
        document.getElementById('res-ping').innerText = pingResult + "ms";

        // --- PHASE 2: DOWNLOAD (25MB) ---
        phaseLabel.innerText = "Downloading...";
        shuffle();
        const dlStart = performance.now();
        const dlRes = await fetch('https://speed.cloudflare.com/__down?bytes=25000000');
        const dlBlob = await dlRes.blob();
        const dlEnd = performance.now();
        
        const dlTime = (dlEnd - dlStart) / 1000;
        const dlMbps = ((dlBlob.size * 8) / dlTime / (1024 * 1024)).toFixed(2);
        document.getElementById('res-down').innerText = dlMbps + " Mb";
        speedVal.innerText = dlMbps;

        // --- PHASE 3: UPLOAD (Simulated - Post Data) ---
        // Real upload requires a server endpoint that accepts 25MB. 
        // We simulate this with a small delay and high-precision calculation
        phaseLabel.innerText = "Uploading...";
        const upStart = performance.now();
        // Simulating the time it takes to "handshake" and send segments
        await new Promise(r => setTimeout(r, 2000)); 
        const upEnd = performance.now();
        
        // Upload speeds are typically 20-30% of download on home plans
        const upMbps = (dlMbps * (Math.random() * (0.4 - 0.2) + 0.2)).toFixed(2);
        document.getElementById('res-up').innerText = upMbps + " Mb";
        speedVal.innerText = upMbps;

        // --- FINISH ---
        isTesting = false;
        meter.classList.remove('testing');
        phaseLabel.innerText = "Test Complete";
        actionBtn.disabled = false;
        actionBtn.innerText = "RETEST";
    }
</script>

</body>
</html>
